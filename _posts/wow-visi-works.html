title: Wow... Visi works
date: 2011/12/16 12:01:17 -0800
tags: []
author: David Pollak
alias: /wow-visi-works

Well, it&#39;s been a month since I announced the whole Visi thing.  When I announces, I had a barely functional type checker and inferencer and a barely functional expression evaluator. <p /><div>That&#39;s all changed in the last month.  As I&#39;ve gotten my Haskell Foo on and gone with an <a href="http://dysphoria.net/2009/06/28/hindley-milner-type-inference-in-scala/">existing implementation</a> of <a href="http://en.wikipedia.org/wiki/Type_inference">Hindley-Milner</a> type checking rather than trying to write my own from first principals, I&#39;ve made a ton of progress with the Visi language.</div> <p /><div>For example, Visi can implement Factorial:</div><p /><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>fact n = if n == 0 then 1 else n * fact n - 1</div> </div><div><div>res = fact 10 //  testResults [(&quot;res&quot;, DoubleValue 3628800)] . checkResults)</div></div></blockquote><br /> <div><div>The above code is taken right out of the Visi test suite.  Parsing, type checking, and computation works</div><p /><div>Visi supports inner functions.  Rather than having an explicit &quot;let&quot; in the Visi syntax, you can define a local function &#39;fact&#39; is referenced inside the &#39;f&#39; function.  The local &#39;fact&#39; function is passed, partially applied, to the &#39;app&#39; function and correctly applied:</div> <blockquote style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"> <div><p /><div><span style="font-family: courier new,monospace;">fact n = n &amp; \&quot;hello\&quot; {-  propper scoping this fact is not the inner fact -}</span></div> <div><div style="font-family: courier new,monospace;"><div>f n = {- Test partially applied functions -}</div><div>  fact n = if n == 0 then 1 else n * fact(n - 1)</div><div>  app n fact</div> <div>app v f = f v</div><div>res = f 8 // testResults [(&quot;res&quot;, DoubleValue 40320.0)] . checkResults)</div><p /></div></div></div></blockquote></div><div><div>Local functions close over scope.  For example, &#39;f&#39; returns a local function that takes two parameters and references the &#39;b&#39; variable and computes the product of the three variables.  The &#39;q&#39; function applies &#39;f&#39; to 8 and &#39;z&#39; applies &#39;f&#39; to 10.  WIth these functions, we can apply or partially apply the functions:</div> <p /><blockquote style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"> <div><div><span style="font-family: courier new,monospace;">f b = {- test that the function closes over local scope -}</span></div><div><div>   timesb n m = n * b * m</div><div>  timesb</div><div>app v f = f v</div><div>q = f 8</div><div>z = f 10</div><div>res = (app 9 (app 8 q)) - ((z 8 9) + (z 1 1)) // testResults [(&quot;res&quot;, DoubleValue (-154))] . checkResults)</div> </div></div></blockquote><br /></div><div>Note, too, the clean syntax.  No line-end characters.  No &quot;let&quot; keyword (although variable shadowing is possible and not yet flagged as an error).</div> <p /><div>So, check out the <a href="https://github.com/visi-lang/visi/blob/b73f83220f975d8f532a23675489933d8b06fac5/core/src/Tests.hs">tests</a> to get a better sense of both the Visi language and the test harness that I&#39;m using for Test Driven Development.</div>
